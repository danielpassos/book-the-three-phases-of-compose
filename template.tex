\documentclass[12pt]{book}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                    PACKAGE INCLUDES                       %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Geometry and fonts
\usepackage[margin=1in]{geometry}      % 1-inch margins
\usepackage{fontspec}                  % Required for modern fonts (XeLaTeX)
\usepackage{lmodern}                  % Base font set (fallback)
\usepackage{xcolor}                    % Color definitions

% Headers and titles
\usepackage{fancyhdr}                  % Custom headers/footers
\usepackage{titlesec}                 % Control section formatting
\usepackage{graphicx}                 % Image support

% Lists
\usepackage{enumitem}                 % Custom list styles

% Code and highlighting
\usepackage{fancyvrb}                 % Rich verbatim environments
\usepackage{fvextra}                  % Extra options for code blocks
\usepackage{framed}                   % For shaded environments
\usepackage{hyperref}                 % Links and metadata
\hypersetup{
  colorlinks=true,
  linkcolor=blue,
  urlcolor=blue,
  pdfstartview=FitH,
  bookmarksopen=true,
  bookmarksdepth=2
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                   FONT SETTINGS                           %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Main font (sans-serif for modern look)
\renewcommand{\familydefault}{\sfdefault}

% Monospaced font (for code)
\setmonofont{Fira Code}

% Inline code appearance (cleaner \texttt)
\usepackage{etoolbox}
\AtBeginEnvironment{document}{
  \renewcommand{\texttt}[1]{\begingroup\ttfamily\footnotesize#1\endgroup}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                     WATERMARK (Optional)                  %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

$if(preview)$
\usepackage{draftwatermark}
\SetWatermarkText{PREVIEW}
\SetWatermarkScale{1.2}
\SetWatermarkColor[gray]{0.85}
\SetWatermarkAngle{40}
$endif$

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                     SECTION STYLING                       %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\titleformat{\chapter}[display]
  {\normalfont\Huge\bfseries}
  {\chaptertitlename\ \thechapter}{20pt}{\Huge}

\titlespacing*{\section}{0pt}{2.2ex plus 1ex minus .2ex}{1.2ex plus .2ex}
\titlespacing*{\subsection}{0pt}{2ex plus .8ex minus .2ex}{1ex plus .2ex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                     HEADER / FOOTER                       %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pagestyle{fancy}
\fancyhf{}
\fancyhead[LE,RO]{\thepage}
\fancyhead[LO]{\leftmark}
\fancyhead[RE]{\rightmark}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                     LIST STYLING                          %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Paragraph spacing
\setlength{\parskip}{0.5em}
\setlength{\parindent}{0pt}

% List spacing improvements
\setlist{topsep=0.5em, partopsep=0em, itemsep=0.4em, parsep=0.2em}

% Fix tight list rendering for Pandoc
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0.4em}\setlength{\parskip}{0em}}

% Use • instead of ▪ and fix left indentation and spacing
\setlist[itemize]{label=•, left=1.5em, topsep=0.7em}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                     CODE BLOCK STYLING                    %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Style for shaded code blocks
\definecolor{shadecolor}{RGB}{240,240,240}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}

% Define syntax-highlighted block
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{
  breaklines,
  fontsize=\footnotesize,
  baselinestretch=1.2,
  commandchars=\\\{\}
}

% Define token macros for syntax highlighting
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{#1}}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{#1}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.36,0.54,0.66}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.65,0.00,0.00}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{#1}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{#1}}
\newcommand{\TypeTok}[1]{\textcolor[rgb]{0.44,0.00,0.87}{#1}}
\newcommand{\NumberTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.52,0.00,0.26}{#1}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ExtensionTok}[1]{\textcolor[rgb]{0.00,0.55,0.55}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.55,0.00,0.00}{#1}}
\newcommand{\BuiltInTok}[1]{\textcolor[rgb]{0.00,0.45,0.45}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.00,0.20,0.80}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.50,0.50,0.50}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.50,0.00,0.50}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.25,0.25}{#1}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.44,0.00,0.87}{#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                     TITLE PAGE & CONTENT                  %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

$if(title)$
\title{$title$}
$endif$
$if(author)$
\author{$author$}
$endif$
$if(date)$
\date{$date$}
$endif$

\begin{document}

$if(title)$
\maketitle
$endif$

$if(toc)$
\tableofcontents
\clearpage
$endif$

$body$

\end{document}
